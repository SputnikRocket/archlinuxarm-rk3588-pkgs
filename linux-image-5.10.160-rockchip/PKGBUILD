# Maintainer: SputnikRocket, Joshua-Riek
pkgname=linux-image-5.10.160-rockchip
pkgver=5.10.160
pkgrel=14
pkgdesc="Linux kernel, version 5.10.160 for rockchip rk3588. This package contains the Linux kernel, modules, and mkinitcpio preset"
arch=('aarch64')
url=""
license=('')
groups=('')
options=('!strip' '!emptydirs')
install=${pkgname}.install
source=(
	"https://launchpad.net/~jjriek/+archive/ubuntu/rockchip/+build/26744068/+files/linux-image-5.10.160-rockchip_5.10.160-14_arm64.deb"
	'linux-5.10.160-rockchip.preset'
)
sha512sums=(
	'b170dd10391073667f926367ba961347c636213804032979b0c661cc7522cadb20aef9c454af0f412aee97ba6492754afb9c7b2018ec567b6e08ff6278cc0c7d'
	'ac5fb1fd143e1fcb337768a32952f8310620429404f194f1d0a16e6089e02d4db877796957b5fdcea89a5c94f5c124519cca614b54217fc5f0da836793016bb8'
)

package(){

	# Extract package data
	tar -xI unzstd -f data.tar.zst -C "${pkgdir}"
	
	#add mkinitcpio
	mkdir -p "${pkgdir}/etc/mkinitcpio.d"
	cp "${srcdir}/linux-5.10.160-rockchip.preset" "${pkgdir}/etc/mkinitcpio.d/linux-5.10.160-rockchip.preset"
	chmod 644 "${pkgdir}/etc/mkinitcpio.d/linux-5.10.160-rockchip.preset"
	
	#copy dtbs to correct path
	mkdir -p "${pkgdir}/boot/dtbs/rockchip"
	cp -r ${pkgdir}/usr/lib/linux-image-5.10.160-rockchip/rockchip/* "${pkgdir}/boot/dtbs/rockchip/"

	# Fix directory structure differences
	cd "${pkgdir}"

	install -D -m644 "usr/share/doc/linux-image-5.10.160-rockchip/copyright" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
	mkdir -p usr/lib 2> /dev/null; mv lib/* usr/lib; rm -rf lib

	cd ..

}
